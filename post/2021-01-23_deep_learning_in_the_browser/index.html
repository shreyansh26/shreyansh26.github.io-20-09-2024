<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Shreyansh Singh">

  
  
  
    
  
  <meta name="description" content="After my last post on deploying Machine Learning and Deep Learning models using FastAPI and Docker, I wanted to explore a bit more on deploying deep learning models. My last post discussed a server-side method for deploying the model. This post will discuss client side frameworks and techniques to deploy those models such that they work directly on the client side.
In this tutorial I will be giving an overview of three frameworks, Tensorflow.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2021-01-23_deep_learning_in_the_browser/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato%7CInconsolata%7CAnonymous+Pro:400&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153509490-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           document.location = url;
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target);  
  }

  gtag('js', new Date());
  gtag('config', 'UA-153509490-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/shreyansh-icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/shreyansh-icon-192.png">

  <link rel="canonical" href="/post/2021-01-23_deep_learning_in_the_browser/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@shreyansh_26">
  <meta property="twitter:creator" content="@shreyansh_26">
  
  <meta property="og:site_name" content="Shreyansh Singh">
  <meta property="og:url" content="/post/2021-01-23_deep_learning_in_the_browser/">
  <meta property="og:title" content="Deep Learning in the Browser - Exploring TF.js, WebDNN and ONNX.js | Shreyansh Singh">
  <meta property="og:description" content="After my last post on deploying Machine Learning and Deep Learning models using FastAPI and Docker, I wanted to explore a bit more on deploying deep learning models. My last post discussed a server-side method for deploying the model. This post will discuss client side frameworks and techniques to deploy those models such that they work directly on the client side.
In this tutorial I will be giving an overview of three frameworks, Tensorflow."><meta property="og:image" content="/post/2021-01-23_deep_learning_in_the_browser/featured.png">
  <meta property="twitter:image" content="/post/2021-01-23_deep_learning_in_the_browser/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2021-01-23T12:53:13&#43;05:30">
    
    <meta property="article:modified_time" content="2021-01-23T12:53:13&#43;05:30">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2021-01-23_deep_learning_in_the_browser/"
  },
  "headline": "Deep Learning in the Browser - Exploring TF.js, WebDNN and ONNX.js",
  
  "image": [
    "/post/2021-01-23_deep_learning_in_the_browser/featured.png"
  ],
  
  "datePublished": "2021-01-23T12:53:13+05:30",
  "dateModified": "2021-01-23T12:53:13+05:30",
  
  "author": {
    "@type": "Person",
    "name": "Shreyansh Singh"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Shreyansh Singh",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/shreyansh-icon-512.png"
    }
  },
  "description": "After my last post on deploying Machine Learning and Deep Learning models using FastAPI and Docker, I wanted to explore a bit more on deploying deep learning models. My last post discussed a server-side method for deploying the model. This post will discuss client side frameworks and techniques to deploy those models such that they work directly on the client side.\nIn this tutorial I will be giving an overview of three frameworks, Tensorflow."
}
</script>

  

  


  


  

<style>

    @font-face {
        font-family: monaco123;
        font-weight: 100%;
        font-style: normal;
        src: url("/fonts/MONACO.TTF");
    } 

    code {
        font-family: monaco123;
        font-size: 100%;
    }

</style>




  <title>Deep Learning in the Browser - Exploring TF.js, WebDNN and ONNX.js | Shreyansh Singh</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">Shreyansh Singh</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post/"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Shreyansh_Resume.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Deep Learning in the Browser - Exploring TF.js, WebDNN and ONNX.js</h1>

  
  <p class="page-subtitle">Just a quick tutorial to set up a small scale deployment for your ML or DL model</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    



  
  <span><a href="/authors/shreyansh-singh/">Shreyansh Singh</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Jan 23, 2021
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    9 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="/post/2021-01-23_deep_learning_in_the_browser/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/machine-learning/">Machine Learning</a></span>
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 263px;">
  <div style="position: relative">
    <img src="/post/2021-01-23_deep_learning_in_the_browser/featured_hu68de34ad03968468f047d63670097f8a_92308_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    <span class="article-header-caption">Tensorflow.js, WebDNN, ONNX.js</span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>After my <a href="/post/2020-11-30_fast_api_docker_ml_deploy">last post</a> on deploying Machine Learning and Deep Learning models using FastAPI and Docker, I wanted to explore a bit more on deploying deep learning models. My last post discussed a server-side method for deploying the model. This post will discuss client side frameworks and techniques to deploy those models such that they work directly on the client side.</p>
<p>In this tutorial I will be giving an overview of three frameworks, <a href="https://www.tensorflow.org/js">Tensorflow.js</a>, <a href="https://mil-tokyo.github.io/webdnn/">WebDNN</a> and <a href="https://microsoft.github.io/onnxjs-demo/#/">ONNX.js</a>. I will be a deploying a simple pretrained image classification model (ResNet or Mobilenet) on the three frameworks and also tell you the comparsion between them. In this tutorial, I haven&rsquo;t deployed custom models of my own but I will be explaining how you can do it and the difficulties you could encounter.</p>
<p>The goal of this blog post is to introduce the three frameworks and how you can use them for deploying your models as well. Personally, I had not heard of WebDNN and ONNX.js before diving into this project, so I believe it can help some others like me to get familiar with these frameworks.</p>
<h2 id="tensorflowjs">Tensorflow.js</h2>
<p>I found Tensorflow.js to be the easiest to use. It already has a large collection of some <a href="https://github.com/tensorflow/tfjs-models">pretrained models</a>. With Tensorflow.js, we don&rsquo;t have a pretrained Resnet model because it is not exactly a lightweight model that can be deployed on a device with low compute power. So, I used <a href="https://arxiv.org/abs/1704.04861">Mobilenet</a> (which is trained on the Imagenet dataset). Mobilenet was available in the Tensorflow.js pretrained models repository so I decided to use that directly.</p>
<p>Now, on to the fun part, actually using the model and making a webapp. For the webapp portion, I am using <a href="https://expressjs.com/">Express</a>, a web framework for Node.js. I have tried to keep the code structure and the webapp visually similar for all the three frameworks.</p>
<p>Loading the model is as simple as -</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/dfedd9a445841a8bb963af9526a9f21c.js"></script>

<p>Now after loading the model, we call the <code>imgSet</code> function which bascially loads the image from the path we specify and loads it onto a canvas. Details of this can be seen in the code which I will post at the end.</p>
<p>Although the Mobilenet model in Tensoflow.js doesn&rsquo;t require a fixed size of the image, but for uniformity in all other frameworks (WebDNN, ONNX.js), I decided to resize the images to 224x224 size. The main code for running the model is shown below -</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/3b1bc92aa52a13cabae2f426b36c2576.js"></script>

<p>The final webapp looks something like this -</p>













<figure>


  <a data-fancybox="" href="/post/2021-01-23_deep_learning_in_the_browser/images/tfapp.gif" data-caption="Image loading and prediction">
<img src="/post/2021-01-23_deep_learning_in_the_browser/images/tfapp.gif" alt="" ></a>


  
  
  <figcaption>
    Image loading and prediction
  </figcaption>


</figure>

<p>The model works well. It knows it is some kind of a water related animal, and given the Imagenet classes it has been trained on, it gies the closest result possible.</p>
<p>The first prediction takes time (196ms) because the model is loaded and run for the first time. After that, the predictions take very little time (~80ms) mainly because the model is cached and predictions can be served faster.</p>
<p>A plot of the average time taken by different backends (over 20 predictions) is also shown below -</p>
<table>
<thead>
<tr>
<th>Backend</th>
<th>Time</th>
</tr>
</thead>
<tbody>
<tr>
<td>cpu</td>
<td>2100ms</td>
</tr>
<tr>
<td>wasm</td>
<td>82ms</td>
</tr>
<tr>
<td>webgl</td>
<td>70ms</td>
</tr>
</tbody>
</table>
<p>If one wants to convert their own models to a Tensorflow.js compatible version, it is very easy to convert the model as well as load it into your web application. One can refer to <a href="https://github.com/tensorflow/tfjs/tree/master/tfjs-converter">tfjs-converter</a> and the documentation given <a href="https://www.tensorflow.org/js/guide/conversion">here</a>.</p>
<p>The code for this section is present <a href="https://github.com/shreyansh26/DeepLearning-in-the-Browser/tree/main/TF">on my Github</a>.</p>
<h2 id="webdnn">WebDNN</h2>
<p><a href="https://mil-tokyo.github.io/webdnn/">WebDNN</a> was developed by the Machine Intellignece Laboratory at the University of Tokyo. From its website,</p>
<blockquote>
<p>WebDNN optimizes the trained DNN model to compress the model data and accelerate the execution, and executes it with novel JavaScript API such as WebAssembly and WebGPU to achieve zero-overhead execution. WebDNN supports 4 execution backend implementations: WebMetal, WebGL, WebAssembly, and fallback pure javascript implementation. By using these backends, WebDNN works all major browsers.</p>
</blockquote>
<p>More details are available on the website, but the image below accurately depicts the steps involved in this procedure.</p>













<figure>


  <a data-fancybox="" href="/post/2021-01-23_deep_learning_in_the_browser/images/webdnn-arch.PNG" data-caption="WebDNN model conversion flow">
<img src="/post/2021-01-23_deep_learning_in_the_browser/images/webdnn-arch.PNG" alt="" ></a>


  
  
  <figcaption>
    WebDNN model conversion flow
  </figcaption>


</figure>

<p>WebDNN can be used to deploy tarined DNN models trained using popular DL frameworks like Tensorflow, Keras, PyTorch, Chainer, Kaffe. One disadvantage I found of using WebDNN is that the current model conversion module (as of writing the post) does not allow conversion using Tensorflow 2 and also does not support the latest versions of Keras (let alone <code>tensorflow.keras</code>).</p>
<p>I used a pretrained ResNet50 model (trained on Imagnet dataset) for this. I am sharing the <a href="https://colab.research.google.com/drive/1pFdbZc5_Dd78twKshl-MH8T_EuVrH0Nw?usp=sharing">following Colab notebook</a> which contains the code to convert the ResNet50 Keras model.</p>
<p>On to the web app coding part! The first thing the webapp does is to load the model.</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/a527987583919e53b237a7d1a312f3a8.js"></script>

<p>Next, we write the code to run the model on the image input.</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/a7a9eb637f31e9dee0a2b39822ebc4b7.js"></script>

<p>The final webapp looks something like this -</p>













<figure>


  <a data-fancybox="" href="/post/2021-01-23_deep_learning_in_the_browser/images/webdnn.gif" data-caption="WeebDNN predictions">
<img src="/post/2021-01-23_deep_learning_in_the_browser/images/webdnn.gif" alt="" ></a>


  
  
  <figcaption>
    WeebDNN predictions
  </figcaption>


</figure>

<p>The model does a very good job of identifying it is a bus. The top two predictions relate to it.</p>
<p>Again, the first run takes a long time (~242ms) but the subsequent runs take quite less (~63ms average). Now one must note that ResNet50 is a relatively heavier model as compared to Mobilenet, but WebDNN manages to load it much faster than or at par with Mobilenet as we saw in the case with Tensorflow.js. Also, in the COlab notebook, we can see that for the same image, the ResNet50 model around 645ms to run the model. We easily see a ~10x improvement on converting the model to WebDNN.</p>
<p>A plot of the average time taken by different backends (over 20 predictions) is also shown below -</p>
<table>
<thead>
<tr>
<th>Backend</th>
<th>Time</th>
</tr>
</thead>
<tbody>
<tr>
<td>cpu</td>
<td>10000ms</td>
</tr>
<tr>
<td>webgl</td>
<td>60ms</td>
</tr>
</tbody>
</table>
<p>WebDNN is quite optimised to run on futuristic hardware. The time it takes on a normal fallback vanilla-JS model version running on the CPU is around 10 seconds. But on WebGL, it takes much much less. I didn&rsquo;t have access to a WebMetal backend, which they claim is the fastest. I would like to know if anyone runs it on WebGPU (WebMetal) and the average time the model took to run on it.</p>
<p>The code for this section is present <a href="https://github.com/shreyansh26/DeepLearning-in-the-Browser/tree/main/WebDNN">on my Github</a>.</p>
<h2 id="onnx">ONNX</h2>
<p><a href="https://onnx.ai/">Open Neural Network Exchange (ONNX)</a> is an open source format for AI models, both deep learning and traditional ML.</p>
<p>From their website -</p>
<blockquote>
<p>ONNX defines a common set of operators - the building blocks of machine learning and deep learning models - and a common file format to enable AI developers to use models with a variety of frameworks, tools, runtimes, and compilers.</p>
</blockquote>
<hr>
<p>Since the goal here is just to make a POC deployment, we make a very simple model trained on the Iris dataset. Some very basic knowledge of Scikit-learn libraries will be needed to understnad the code.</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/fcb121e5c428895be24e58edec1c3ebe.js"></script>

<p>The model is saved in a pickle format. We will load the saved model to do predictions later.</p>
<p>Now, along with this, we have to ensure that when the API will receive the paprameters, it receives them in a proper format, for example, a list of lists in which each list has 4 float values for the features.</p>
<p>For that we use <a href="https://github.com/samuelcolvin/pydantic">Pydantic</a>.</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/f45af7bad35c6c75cc695dd8f209c2c7.js"></script>

<h2 id="creating-the-api">Creating the API</h2>
<p>As mentioned earlier, we use FastAPI to make our API. From the website -</p>
<blockquote>
<p>FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints.</p>
</blockquote>
<p>It also claims to have <em>Very high performance, on par with NodeJS and Go (thanks to Starlette and Pydantic). One of the fastest Python frameworks available.</em></p>
<p>The whole code is given below, I&rsquo;ll explain the details below as well.</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/3ccaafb643fb1d387137550c715610cc.js"></script>

<p>Here, we define the name of our app.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">app <span style="color:#f92672">=</span> FastAPI(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Iris Classifier API&#34;</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;API for Iris classification using ML&#34;</span>, version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span>)
</code></pre></div><p>Next, we set up logging for our API as well, to ensure we can see WHEN something went wrong, in case something does go wrong.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Initialize logging</span>
my_logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger()
my_logger<span style="color:#f92672">.</span>setLevel(logging<span style="color:#f92672">.</span>DEBUG)
logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>DEBUG, filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;logs.log&#39;</span>)
</code></pre></div><p>Then we use a FastAPI decorator called <code>@app.on_event(&quot;startup&quot;)</code> to specify the operation which we want to perform when the server starts up. Here we load our model so that once the model is loaded in the initial phase, the predictions can be served as fast as possible.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@app.on_event</span>(<span style="color:#e6db74">&#34;startup&#34;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_model</span>():
    model <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(open(<span style="color:#e6db74">&#34;models/model.pkl&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>))
</code></pre></div><p>Finally, our main logic of serving the predictions -</p>
<p>We get the data that the API receives from the server and require it to be in the <code>Iris</code> format, which we specified using Pydantic.</p>
<p>We run the model on those examples, get the predictions and then map them to the flower type. The classification and the model probability of the prediction is returned as a JSON response.</p>
<p>We have a try-catch blog to make ensure any wrong input format or any other kinds of errors does not break the server.</p>
<h2 id="lets-see-it-in-action">Let&rsquo;s see it in action</h2>
<p>The FastAPI provides a dashboard from where we send requests to the API. It is at <code>http://localhost:8000/docs</code>.</p>













<figure>


  <a data-fancybox="" href="/post/2020-11-30_fast_api_docker_ml_deploy/images/docs.PNG" data-caption="Sending sample request to FastAPI">
<img src="/post/2020-11-30_fast_api_docker_ml_deploy/images/docs.PNG" alt="" ></a>


  
  
  <figcaption>
    Sending sample request to FastAPI
  </figcaption>


</figure>














<figure>


  <a data-fancybox="" href="/post/2020-11-30_fast_api_docker_ml_deploy/images/response.PNG" data-caption="Response from FastAPI">
<img src="/post/2020-11-30_fast_api_docker_ml_deploy/images/response.PNG" alt="" ></a>


  
  
  <figcaption>
    Response from FastAPI
  </figcaption>


</figure>

<h2 id="dockerise-everything">Dockerise Everything!</h2>
<p>So now, if we have to ship it, we want to convert it into a Docker image.</p>
<p>For that we create a Dockerfile.</p>
<script type="application/javascript" src="https://gist.github.com/shreyansh26/f4d7a32e2790b32a8f18dbcb583cc817.js"></script>

<p>Basically, the Dockerfile instructs Docker to first create a <code>/app</code> folder inside the Docker <strong>python3.8</strong> base image, install the requirements (Python packages) and then run the app on port 8000 in the Docker container, and expose that port to access it from our local machine.</p>
<p>Now, we just have to run two commands -</p>
<pre><code>$ docker build -t iris-ml .  # Build the Docker image
$ docker run -d -p 8000:8000 --name iris-api iris-ml   # Run the Docker image as container
</code></pre><p>The requirements.txt for the project are also listed below -</p>
<pre><code>numpy==1.18.4
pydantic==1.6.1
requests==2.24.0
fastapi==0.61.1
scikit_learn==0.23.2
uvicorn==0.11.8
</code></pre><p>Now you can head to <a href="%5Bhttp://localhost:8000/docs%5D">http://localhost:8000/docs</a> to test the API.</p>
<p>If you see the dashboard and the responses similar to the screenshots above, you have most likely deployed it successfully.</p>
<h3 id="congratulations">Congratulations!!</h3>
<p>Now that you have the Docker image, the entire environment can be recreated on any other machine. You can push the image to DockerHub (<a href="https://ropenscilabs.github.io/r-docker-tutorial/04-Dockerhub.html">refer here</a>) or export as a <a href="https://stackoverflow.com/questions/23935141/how-to-copy-docker-images-from-one-host-to-another-without-using-a-repository">tar file</a> to share to another host.</p>
<hr>
<p>The entire code is also available on my Github - <a href="https://github.com/shreyansh26/Weekend-Projects/tree/master/MLDeployment/v1">https://github.com/shreyansh26/Weekend-Projects/tree/master/MLDeployment/v1</a></p>
<p>  </p>
<p>This is all for now. I will also be writing about few other approaches to deploy relatively heavier models and also scalable approaches to Model hosting. Thanks for reading!</p>
<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script>
<!-- <button style="background-color: #70ab17; color: #1770AB" id="openpopup">Subscribe to my posts!</button> -->
<div class="button_cont" align="center"><button id="openpopup" class="example_a">Subscribe to my posts!</button></div>
<style>
    .example_a {
        color: #fff !important;
        text-transform: uppercase;
        text-decoration: none;
        background: #3f51b5;
        padding: 20px;
        border-radius: 5px;
        cursor: pointer;
        display: inline-block;
        border: none;
        transition: all 0.4s ease 0s;
    }

    .example_a:hover {
        background: #434343;
        letter-spacing: 1px;
        -webkit-box-shadow: 0px 5px 40px -10px rgba(0,0,0,0.57);
        -moz-box-shadow: 0px 5px 40px -10px rgba(0,0,0,0.57);
        box-shadow: 5px 40px -10px rgba(0,0,0,0.57);
        transition: all 0.4s ease 0s;
    }
</style>
<script type="text/javascript">

function showMailingPopUp() {
    window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us4.list-manage.com","uuid":"0b10ac14f50d7f4e7d11cf26a","lid":"667a1bb3da","uniqueMethods":true}) })

    document.cookie = "MCPopupClosed=;path=/;expires=Thu, 01 Jan 1970 00:00:00 UTC";
}

document.getElementById("openpopup").onclick = function() {showMailingPopUp()};

</script>
<p> </p>
<p>Follow me on <a href="https://twitter.com/shreyansh_26">Twitter</a>, <a href="https://github.com/shreyansh26">Github</a> or connect on <a href="https://www.linkedin.com/in/shreyansh26/">LinkedIn</a>.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/dl/">dl</a>
  
  <a class="badge badge-light" href="/tags/deep-learning/">deep learning</a>
  
  <a class="badge badge-light" href="/tags/deployment/">deployment</a>
  
  <a class="badge badge-light" href="/tags/web/">web</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/2021-01-23_deep_learning_in_the_browser/&amp;text=Deep%20Learning%20in%20the%20Browser%20-%20Exploring%20TF.js,%20WebDNN%20and%20ONNX.js" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/2021-01-23_deep_learning_in_the_browser/&amp;t=Deep%20Learning%20in%20the%20Browser%20-%20Exploring%20TF.js,%20WebDNN%20and%20ONNX.js" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Deep%20Learning%20in%20the%20Browser%20-%20Exploring%20TF.js,%20WebDNN%20and%20ONNX.js&amp;body=/post/2021-01-23_deep_learning_in_the_browser/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/2021-01-23_deep_learning_in_the_browser/&amp;title=Deep%20Learning%20in%20the%20Browser%20-%20Exploring%20TF.js,%20WebDNN%20and%20ONNX.js" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Deep%20Learning%20in%20the%20Browser%20-%20Exploring%20TF.js,%20WebDNN%20and%20ONNX.js%20/post/2021-01-23_deep_learning_in_the_browser/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  
    
  
  






  
  
  
  
  <div class="media author-card content-widget-hr">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/shreyansh-singh/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
</ul>

    </div>
  </div>




<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "shreyansh26-netlify-com" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/post/2020-11-30_fast_api_docker_ml_deploy/" rel="prev">Quick tutorial to deploy your ML models using FastAPI and Docker</a>
  </div>
  
</div>

</div>



  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/2020-11-30_fast_api_docker_ml_deploy/">Quick tutorial to deploy your ML models using FastAPI and Docker</a></li>
      
      <li><a href="/project/privacy-ml/">Privacy-preserving Machine Learning using Secure Multiparty Computation</a></li>
      
      <li><a href="/project/msr-nlg/">Multilingual Surface Realization for NLG</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/cpp.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/js.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    <script id="dsq-count-scr" src="https://shreyansh26-netlify-com.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © Shreyansh Singh 2021 &middot; 

    Powered by 
    
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
