<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Shreyansh Singh">

  
  
  
    
  
  <meta name="description" content="crypto 115 - 108 solves  We intercept an algorithm that is used among Androids. There are many hidden variables. Is it possible to recover the message?
  Author: andre_smaira
  Server: nc encryption.pwn2.win 1337
 Challenge link
Challenge files
On connecting to the challenge service, we are given two options -
Also, in the server.py file, we see there are two functions, enc_plaintext and enc_flag.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2020-06-01_androids_encryption-pwn2win-2020/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=B612+Mono:400,700%7COrbitron:400,700%7CSpace+Mono:400,700%7CLato%7CMontserrat%7CInconsolata%7COpen+Sans&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153509490-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           document.location = url;
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target);  
  }

  gtag('js', new Date());
  gtag('config', 'UA-153509490-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/shreyansh-icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/shreyansh-icon-192.png">

  <link rel="canonical" href="/post/2020-06-01_androids_encryption-pwn2win-2020/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@shreyansh_26">
  <meta property="twitter:creator" content="@shreyansh_26">
  
  <meta property="og:site_name" content="Shreyansh Singh">
  <meta property="og:url" content="/post/2020-06-01_androids_encryption-pwn2win-2020/">
  <meta property="og:title" content="Androids Encryption (Crypto) - Pwn2Win CTF 2020 | Shreyansh Singh">
  <meta property="og:description" content="crypto 115 - 108 solves  We intercept an algorithm that is used among Androids. There are many hidden variables. Is it possible to recover the message?
  Author: andre_smaira
  Server: nc encryption.pwn2.win 1337
 Challenge link
Challenge files
On connecting to the challenge service, we are given two options -
Also, in the server.py file, we see there are two functions, enc_plaintext and enc_flag."><meta property="og:image" content="/post/2020-06-01_androids_encryption-pwn2win-2020/featured.png">
  <meta property="twitter:image" content="/post/2020-06-01_androids_encryption-pwn2win-2020/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-06-01T12:32:46&#43;05:30">
    
    <meta property="article:modified_time" content="2020-06-01T12:32:46&#43;05:30">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2020-06-01_androids_encryption-pwn2win-2020/"
  },
  "headline": "Androids Encryption (Crypto) - Pwn2Win CTF 2020",
  
  "image": [
    "/post/2020-06-01_androids_encryption-pwn2win-2020/featured.png"
  ],
  
  "datePublished": "2020-06-01T12:32:46+05:30",
  "dateModified": "2020-06-01T12:32:46+05:30",
  
  "author": {
    "@type": "Person",
    "name": "Shreyansh Singh"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Shreyansh Singh",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/shreyansh-icon-512.png"
    }
  },
  "description": "crypto 115 - 108 solves  We intercept an algorithm that is used among Androids. There are many hidden variables. Is it possible to recover the message?\n  Author: andre_smaira\n  Server: nc encryption.pwn2.win 1337\n Challenge link\nChallenge files\nOn connecting to the challenge service, we are given two options -\n\r\r\rAlso, in the server.py file, we see there are two functions, enc_plaintext and enc_flag."
}
</script>

  

  


  


  

<style>

    @font-face {
        font-family: monaco123;
        font-weight: 100%;
        font-style: normal;
        src: url("/fonts/MONACO.TTF");
    } 

    code {
        font-family: monaco123;
        font-size: 100%;
    }

</style>




  <title>Androids Encryption (Crypto) - Pwn2Win CTF 2020 | Shreyansh Singh</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">Shreyansh Singh</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post/"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Shreyansh_Resume.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  


<div class="article-container pt-3">
  <h1>Androids Encryption (Crypto) - Pwn2Win CTF 2020</h1>

  
  <p class="page-subtitle">My writeup for Androids Encryption challenge in the Pwn2Win CTF 2020</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    



  
  <span><a href="/authors/shreyansh-singh/">Shreyansh Singh</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Jun 1, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="/post/2020-06-01_androids_encryption-pwn2win-2020/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/information-security/">Information Security</a></span>
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 150px; max-height: 150px;">
  <div style="position: relative">
    <img src="/post/2020-06-01_androids_encryption-pwn2win-2020/featured.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h3 id="crypto-115---108-solves">crypto 115 - 108 solves</h3>
<blockquote>
<p>We intercept an algorithm that is used among Androids. There are many hidden variables. Is it possible to recover the message?</p>
</blockquote>
<blockquote>
<p>Author: andre_smaira</p>
</blockquote>
<blockquote>
<p>Server: nc encryption.pwn2.win 1337</p>
</blockquote>
<p><a href="https://pwn2.win/NIZKCTF-js/challenges/androids_encryption">Challenge link</a><br>
<a href="/post/2020-06-01_androids_encryption-pwn2win-2020/files/server.py">Challenge files</a></p>
<p>On connecting to the challenge service, we are given two options -</p>













<figure>


  <a data-fancybox="" href="/post/2020-06-01_androids_encryption-pwn2win-2020/images/options.PNG" >
<img src="/post/2020-06-01_androids_encryption-pwn2win-2020/images/options.PNG" alt="" ></a>



</figure>

<p>Also, in the server.py file, we see there are two functions, <code>enc_plaintext</code> and <code>enc_flag</code>. Both these functions call the <code>encrypt</code> function.</p>
<p>The <code>enc_plaintext</code> functions calls <code>encrypt</code> with the plaintext supplied by the user (encoded in base64), key1 and iv1 (which are secret values) as arguments.<br>
The <code>enc_flag</code> fucntion takes as arguments the secret flag and iv2 and key2 which are actually derived from iv1, key1 and the flag.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">iv2 <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key1, AES<span style="color:#f92672">.</span>MODE_ECB)<span style="color:#f92672">.</span>decrypt(iv1)
key2 <span style="color:#f92672">=</span> xor(to_blocks(flag))
</code></pre></div><p>The <code>encrypt</code> function returns the base64 encoding of the (iv+ciphertext) string.</p>
<h3 id="exploit">Exploit</h3>
<p>We see that every time <code>encrypt</code> is called, the key2 and iv2 values are updated. iv2 becomes the AES-ECB decryption of the old iv2 and key2 is now the first block of the ciphertext (since the xor function with one argument simply returns the first block of the argument). So, our goal is now to recover the key2 and iv2 values so we can then reverse the <code>encrypt_flag</code> function and recover the flag.</p>













<figure>


  <a data-fancybox="" href="/post/2020-06-01_androids_encryption-pwn2win-2020/images/update.PNG" >
<img src="/post/2020-06-01_androids_encryption-pwn2win-2020/images/update.PNG" alt="" ></a>



</figure>

<p>If we call <code>encrypt_flag</code> (Choice 2) the first time, then the new key2 value will be the first block of the ciphertext. Nnow during this, the iv2 has also been updated but we don&rsquo;t know that value, since the first part of the returned value, is the old iv2.</p>
<p>So, what we do next is call the <code>encrypt_flag</code> (Choice 2) function again, then we get the new iv2 value along with the ciphertext. This means taht now we know the iv2 and the key2 value taht was used to encrypt the flag to obtain the ciphertext. What remains now, is just to reverse the <code>encrypt</code> function and call it with our values of the ciphertext, key2 and iv2. This will get us the flag.</p>
<p>The <code>decrypt</code> function can be written as -</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">assert</span> len(key) <span style="color:#f92672">==</span> BLOCK_SIZE, f<span style="color:#e6db74">&#39;Invalid key size&#39;</span>
    <span style="color:#66d9ef">assert</span> len(iv) <span style="color:#f92672">==</span> BLOCK_SIZE, <span style="color:#e6db74">&#39;Invalid IV size&#39;</span>
    <span style="color:#66d9ef">assert</span> len(txt) <span style="color:#f92672">%</span> BLOCK_SIZE <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;Invalid plaintext size&#39;</span>
    bs <span style="color:#f92672">=</span> len(key)
    blocks <span style="color:#f92672">=</span> to_blocks(txt)
    ctxt <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
    aes <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key, AES<span style="color:#f92672">.</span>MODE_ECB)
    curr <span style="color:#f92672">=</span> iv
    <span style="color:#66d9ef">for</span> block <span style="color:#f92672">in</span> blocks:
        ctxt <span style="color:#f92672">+=</span> xor(curr, aes<span style="color:#f92672">.</span>decrypt(block)) <span style="color:#75715e"># Inverse of the encrypt function</span>
        curr <span style="color:#f92672">=</span> xor(ctxt[<span style="color:#f92672">-</span>bs:], block)
    <span style="color:#66d9ef">return</span> ctxt
</code></pre></div><p>The complete exploit code is shown below -</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> base64
<span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES

p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;encryption.pwn2.win&#34;</span>, <span style="color:#ae81ff">1337</span>)
<span style="color:#75715e"># context.log_level = &#39;debug&#39;</span>

BUFF <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>
BLOCK_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>
key2 <span style="color:#f92672">=</span> None
iv2 <span style="color:#f92672">=</span> None

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_blocks</span>(txt):
    <span style="color:#66d9ef">return</span> [txt[i<span style="color:#f92672">*</span>BLOCK_SIZE:(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>BLOCK_SIZE] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(txt)<span style="color:#f92672">//</span>BLOCK_SIZE)]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">xor</span>(b1, b2<span style="color:#f92672">=</span>None):
    <span style="color:#66d9ef">if</span> isinstance(b1, list) <span style="color:#f92672">and</span> b2 <span style="color:#f92672">is</span> None:
        <span style="color:#66d9ef">assert</span> len(set([len(b) <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> b1])) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;xor() - Invalid input size&#39;</span>
        <span style="color:#66d9ef">assert</span> all([isinstance(b, bytes) <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> b1]), <span style="color:#e6db74">&#39;xor() - Invalid input type&#39;</span>
        x <span style="color:#f92672">=</span> [len(b) <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> b1][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>
        <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> b1:
            x <span style="color:#f92672">=</span> xor(x, b)
        <span style="color:#66d9ef">return</span> x
    <span style="color:#66d9ef">assert</span> isinstance(b1, bytes) <span style="color:#f92672">and</span> isinstance(b2, bytes), <span style="color:#e6db74">&#39;xor() - Invalid input type&#39;</span>
    <span style="color:#66d9ef">return</span> bytes([a <span style="color:#f92672">^</span> b <span style="color:#66d9ef">for</span> a, b <span style="color:#f92672">in</span> zip(b1, b2)])

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decrypt</span>(txt, key, iv):
    <span style="color:#66d9ef">assert</span> len(key) <span style="color:#f92672">==</span> BLOCK_SIZE, f<span style="color:#e6db74">&#39;Invalid key size&#39;</span>
    <span style="color:#66d9ef">assert</span> len(iv) <span style="color:#f92672">==</span> BLOCK_SIZE, <span style="color:#e6db74">&#39;Invalid IV size&#39;</span>
    <span style="color:#66d9ef">assert</span> len(txt) <span style="color:#f92672">%</span> BLOCK_SIZE <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;Invalid plaintext size&#39;</span>
    bs <span style="color:#f92672">=</span> len(key)
    blocks <span style="color:#f92672">=</span> to_blocks(txt)
    ctxt <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
    aes <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key, AES<span style="color:#f92672">.</span>MODE_ECB)
    curr <span style="color:#f92672">=</span> iv
    <span style="color:#66d9ef">for</span> block <span style="color:#f92672">in</span> blocks:
        ctxt <span style="color:#f92672">+=</span> xor(curr, aes<span style="color:#f92672">.</span>decrypt(block)) <span style="color:#75715e"># Inverse of the encrypt function</span>
        curr <span style="color:#f92672">=</span> xor(ctxt[<span style="color:#f92672">-</span>bs:], block)
    <span style="color:#66d9ef">return</span> ctxt

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt_flag</span>(p):
	p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Choice: &#34;</span>)
	p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;2&#34;</span>)
	x <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>recvline()<span style="color:#f92672">.</span>strip()
	y <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(x)
	<span style="color:#66d9ef">return</span> y[:<span style="color:#ae81ff">16</span>], y[<span style="color:#ae81ff">16</span>:]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">enc_plaintext</span>(p, plaintext):
	p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Choice: &#34;</span>)
	p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;1&#34;</span>)
	p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Plaintext: &#34;</span>)
	p<span style="color:#f92672">.</span>sendline(plaintext)
	x <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>recvline()<span style="color:#f92672">.</span>strip()
	y <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(x)
	<span style="color:#66d9ef">return</span> y[:<span style="color:#ae81ff">16</span>], y[<span style="color:#ae81ff">16</span>:]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getDecoding</span>(s):
	y <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(s)
	<span style="color:#66d9ef">return</span> y[:<span style="color:#ae81ff">16</span>], y[<span style="color:#ae81ff">16</span>:]

iv2_orig, flag_enc_orig <span style="color:#f92672">=</span> encrypt_flag(p)
<span style="color:#66d9ef">print</span>(iv2_orig)
<span style="color:#66d9ef">print</span>(flag_enc_orig)

key2_new <span style="color:#f92672">=</span> xor(to_blocks(flag_enc_orig))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Key2 :&#34;</span> <span style="color:#f92672">+</span> key2_new)
iv2_new, flag_enc_cipher_new <span style="color:#f92672">=</span> encrypt_flag(p)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;iv2 :&#34;</span>, iv2_new)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;flag_cipher_new :&#34;</span>, flag_enc_cipher_new)

<span style="color:#66d9ef">print</span>(decrypt(flag_enc_cipher_new, key2_new, iv2_new)<span style="color:#f92672">.</span>decode())
</code></pre></div><p>Running this, prints the flag - <strong>CTF-BR{kn3W_7h4T_7hEr3_4r3_Pc8C_r3pe471ti0ns?!?}</strong></p>
<p>And yeah, after reading the flag, I realised it was actually AES in PCBC mode.</p>
<hr>
<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script>
<!-- <button style="background-color: #70ab17; color: #1770AB" id="openpopup">Subscribe to my posts!</button> -->
<div class="button_cont" align="center"><button id="openpopup" class="example_a">Subscribe to my posts!</button></div>
<style>
    .example_a {
        color: #fff !important;
        text-transform: uppercase;
        text-decoration: none;
        background: #3f51b5;
        padding: 20px;
        border-radius: 5px;
        cursor: pointer;
        display: inline-block;
        border: none;
        transition: all 0.4s ease 0s;
    }

    .example_a:hover {
        background: #434343;
        letter-spacing: 1px;
        -webkit-box-shadow: 0px 5px 40px -10px rgba(0,0,0,0.57);
        -moz-box-shadow: 0px 5px 40px -10px rgba(0,0,0,0.57);
        box-shadow: 5px 40px -10px rgba(0,0,0,0.57);
        transition: all 0.4s ease 0s;
    }
</style>
<script type="text/javascript">

function showMailingPopUp() {
    window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us4.list-manage.com","uuid":"0b10ac14f50d7f4e7d11cf26a","lid":"667a1bb3da","uniqueMethods":true}) })

    document.cookie = "MCPopupClosed=;path=/;expires=Thu, 01 Jan 1970 00:00:00 UTC";
}

document.getElementById("openpopup").onclick = function() {showMailingPopUp()};

</script>
<p> </p>
<p>Follow me on <a href="https://twitter.com/shreyansh_26">Twitter</a>, <a href="https://github.com/shreyansh26">Github</a> or connect on <a href="https://www.linkedin.com/in/shreyansh26/">LinkedIn</a>.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/crypto/">crypto</a>
  
  <a class="badge badge-light" href="/tags/infosec/">infosec</a>
  
  <a class="badge badge-light" href="/tags/writeups/">writeups</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/2020-06-01_androids_encryption-pwn2win-2020/&amp;text=Androids%20Encryption%20%28Crypto%29%20-%20Pwn2Win%20CTF%202020" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/2020-06-01_androids_encryption-pwn2win-2020/&amp;t=Androids%20Encryption%20%28Crypto%29%20-%20Pwn2Win%20CTF%202020" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Androids%20Encryption%20%28Crypto%29%20-%20Pwn2Win%20CTF%202020&amp;body=/post/2020-06-01_androids_encryption-pwn2win-2020/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/2020-06-01_androids_encryption-pwn2win-2020/&amp;title=Androids%20Encryption%20%28Crypto%29%20-%20Pwn2Win%20CTF%202020" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Androids%20Encryption%20%28Crypto%29%20-%20Pwn2Win%20CTF%202020%20/post/2020-06-01_androids_encryption-pwn2win-2020/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  
    
  
  






  
  
  
  
  <div class="media author-card content-widget-hr">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/shreyansh-singh/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
</ul>

    </div>
  </div>




<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "shreyansh26-netlify-com" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/post/2020-01-04_malwaretech-vm1-challenge/" rel="prev">MalwareTech&#39;s VM1 Reversing Challenge</a>
  </div>
  
</div>

</div>



  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/2020-01-04_malwaretech-vm1-challenge/">MalwareTech&#39;s VM1 Reversing Challenge</a></li>
      
      <li><a href="/post/2019-12-30_hxp-36c3-ctf/">hxp 36C3 CTF Writeups</a></li>
      
      <li><a href="/post/2019-12-15_watevr-ctf-2019-writeups/">watevrCTF 2019 Writeups (Mainly Rev and Pwn)</a></li>
      
      <li><a href="/post/2019-12-02_tuctf-pwn-2019/">TUCTF 2019 - Pwn &amp; Rev Challenges</a></li>
      
      <li><a href="/post/2019-11-19_ritsec-ctf-2019/">RITSEC CTF 2019</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/cpp.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    <script id="dsq-count-scr" src="https://shreyansh26-netlify-com.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © Shreyansh Singh 2020 &middot; 

    Powered by 
    
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
